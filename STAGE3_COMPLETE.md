# üéâ –≠–¢–ê–ü 3 –ó–ê–í–ï–†–®–ï–ù - –°–µ—Ä–≤–∏—Å—ã (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)

## ‚úÖ –ß–¢–û –°–û–ó–î–ê–ù–û

### **7 —Å–µ—Ä–≤–∏—Å–æ–≤** —Å –ø–æ–ª–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π:

#### 1. **redis_service.py** - Redis –¥–ª—è –≤—Å–µ–≥–æ
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis (async)
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (get, set, delete, exists)
- ‚úÖ **Practice Mode:**
  - `get_practice_progress()` - –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
  - `save_practice_progress()` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
  - TTL: 7 –¥–Ω–µ–π
- ‚úÖ **Exam Session:**
  - `get_exam_session()` - –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é —ç–∫–∑–∞–º–µ–Ω–∞
  - `save_exam_session()` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é
  - `update_exam_answer()` - –æ–±–Ω–æ–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
  - `increment_proctoring_event()` - —Å—á–µ—Ç—á–∏–∫–∏ –ø—Ä–æ–∫—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ **Rate Limiting:**
  - `check_rate_limit()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
  - 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ **Caching:**
  - `cache_get()`, `cache_set()`, `cache_delete()`

#### 2. **auth_service.py** - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ `login()` - –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ username + password
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT (access + refresh)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `refresh_access_token()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
  - –í–∞–ª–∏–¥–∞—Ü–∏—è refresh token
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ access token

#### 3. **question_service.py** - –í–æ–ø—Ä–æ—Å—ã
- ‚úÖ `get_question_by_id()` - –ø–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å
- ‚úÖ `question_to_safe_dict()` - **–ë–ï–ó–û–ü–ê–°–ù–û** (–ë–ï–ó is_correct!)
- ‚úÖ `get_questions_by_subject()` - –≤–æ–ø—Ä–æ—Å—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- ‚úÖ `get_random_questions()` - —Å–ª—É—á–∞–π–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞
- ‚úÖ `check_answer()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ **–¢–û–õ–¨–ö–û –ù–ê –ë–ï–ö–ï–ù–î–ï!**
- ‚úÖ `count_questions_by_subject()` - –ø–æ–¥—Å—á–µ—Ç

#### 4. **practice_service.py** - –°–≤–æ–±–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º ‚≠ê
- ‚úÖ `start_practice()` - –Ω–∞—á–∞–ª–æ –ø—Ä–∞–∫—Ç–∏–∫–∏
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ Redis
  - –ü–æ–¥—Å—á–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ `get_questions()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
  - **–ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ 20 –≤–æ–ø—Ä–æ—Å–æ–≤**
  - **–ë–ï–ó is_correct!**
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ Redis
- ‚úÖ `submit_answer()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
  - **–ú–ì–ù–û–í–ï–ù–ù–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞** (–¢–û–õ–¨–ö–û –¥–ª—è Practice!)
  - –í–æ–∑–≤—Ä–∞—Ç is_correct, correct_keys, explanation
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ Redis
- ‚úÖ `get_practice_stats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ `finish_practice()` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

#### 5. **exam_service.py** - –≠–∫–∑–∞–º–µ–Ω—ã ‚≠ê‚≠ê‚≠ê
- ‚úÖ `start_exam()` - –Ω–∞—á–∞–ª–æ —ç–∫–∑–∞–º–µ–Ω–∞
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –º–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—ã (–ø—Ä–æ—Ñ–∏–ª—å–Ω–∞—è/–Ω–∞—É—á–Ω–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∞—è)
  - **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤:**
    - –ü—Ä–æ—Ñ–∏–ª—å–Ω–∞—è: 50 –≤–æ–ø—Ä–æ—Å–æ–≤ (–¢–ì–û:10, –ê–ù–ì–õ:10, PROFILE1:15, PROFILE2:15)
    - –ù–∞—É—á–Ω–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∞—è: 130 –≤–æ–ø—Ä–æ—Å–æ–≤ (–ê–ù–ì–õ:50, –¢–ì–û:30, PROFILE1:25, PROFILE2:25)
  - –°–æ–∑–¥–∞–Ω–∏–µ ExamAttempt –≤ –ë–î
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –≤ Redis
  - TODO: –ó–∞–ø—É—Å–∫ Celery –∑–∞–¥–∞—á–∏ –Ω–∞ –∞–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- ‚úÖ `get_exam_status()` - —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  - –û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—á–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ `submit_answer()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
  - **–ë–ï–ó –ü–†–û–í–ï–†–ö–ò!** (—Ç–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ Redis
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ `submit_exam()` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç–∫–∑–∞–º–µ–Ω–∞
  - **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–æ–≤**
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ExamAnswer –≤ –ë–î
  - –ü–æ–¥—Å—á–µ—Ç –±–∞–ª–ª–æ–≤
  - –ü—Ä–æ–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  - –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –∏–∑ Redis

#### 6. **proctoring_service.py** - –ü—Ä–æ–∫—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ `log_event()` - —Ñ–∏–∫—Å–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –≤ Redis
- ‚úÖ `log_events_batch()` - –º–∞—Å—Å–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (–º–∞–∫—Å 100)
- ‚úÖ `get_statistics()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∫—Ç–æ—Ä–∏–Ω–≥–∞
  - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - copy_paste, tab_switches, console_opens

#### 7. **user_service.py** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (CRUD)
- ‚úÖ `get_user_by_id()`, `get_user_by_username()`
- ‚úÖ `create_user()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ `update_user()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `delete_user()` - —É–¥–∞–ª–µ–Ω–∏–µ
- ‚úÖ `get_users_list()` - —Å–ø–∏—Å–æ–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- ‚úÖ `count_users_by_role()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–æ–ª—è–º

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –í –°–ï–†–í–ò–°–ê–•

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

**1. QuestionService:**
```python
def question_to_safe_dict(question):
    # ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ë–ï–ó is_correct!
    return {
        "options": [
            {"key": opt["key"], "text": opt["text"]}
            # ‚ùå –ù–ï–¢ is_correct!
        ]
    }

def check_answer(question, selected_keys):
    # ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¢–û–õ–¨–ö–û –Ω–∞ –±–µ–∫–µ–Ω–¥–µ!
    # –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ
    pass
```

**2. PracticeService:**
```python
async def get_questions():
    # ‚úÖ –ë–ï–ó is_correct
    return QuestionResponse(
        options=[QuestionOptionResponse(...)]  # –ë–ï–ó is_correct
    )

async def submit_answer():
    # ‚úÖ –ú–ì–ù–û–í–ï–ù–ù–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è Practice!)
    is_correct, correct_keys = question_service.check_answer(...)
    return SubmitAnswerResponse(
        is_correct=is_correct,  # ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º
        correct_keys=correct_keys
    )
```

**3. ExamService:**
```python
async def submit_answer():
    # ‚úÖ –ë–ï–ó –ü–†–û–í–ï–†–ö–ò! –¢–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    await redis_service.update_exam_answer(...)
    return SubmitAnswerResponse(
        is_correct=None,  # ‚ùå –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º!
        correct_keys=None
    )

async def submit_exam():
    # ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¢–û–õ–¨–ö–û –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    for question_id, selected_keys in answers:
        is_correct, _ = question_service.check_answer(...)
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
    pass
```

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

**–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 8  
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~2500+  
**–ú–µ—Ç–æ–¥–æ–≤:** 50+

### –§–∞–π–ª—ã:
1. `redis_service.py` - 350+ —Å—Ç—Ä–æ–∫
2. `auth_service.py` - 150+ —Å—Ç—Ä–æ–∫
3. `question_service.py` - 200+ —Å—Ç—Ä–æ–∫
4. `practice_service.py` - 250+ —Å—Ç—Ä–æ–∫ ‚≠ê
5. `exam_service.py` - 400+ —Å—Ç—Ä–æ–∫ ‚≠ê‚≠ê‚≠ê
6. `proctoring_service.py` - 200+ —Å—Ç—Ä–æ–∫
7. `user_service.py` - 200+ —Å—Ç—Ä–æ–∫
8. `__init__.py` - —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò

### **Redis Integration**
- –°–µ—Å—Å–∏–∏ —ç–∫–∑–∞–º–µ–Ω–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Redis
- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤ Redis (TTL 7 –¥–Ω–µ–π)
- Rate limiting (60 req/min)
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ TTL

### **Practice Mode**
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ 20 –≤–æ–ø—Ä–æ—Å–æ–≤
- –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### **Exam Mode**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∏–ø—É –º–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—ã
- –û—Ç–≤–µ—Ç—ã –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ –∫–æ–Ω—Ü–∞
- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫ (TODO: –≤ API)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
- –ü—Ä–æ–∫—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### **Proctoring**
- –°–æ–±—ã—Ç–∏—è: copy, paste, tab_switch, console_open
- –°—á–µ—Ç—á–∏–∫–∏ –≤ Redis
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (threshold 10)
- –ú–∞—Å—Å–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–æ 100 —Å–æ–±—ã—Ç–∏–π

---

## üìã –°–õ–ï–î–£–Æ–©–ò–ô –≠–¢–ê–ü

### **–≠—Ç–∞–ø 4: API Endpoints**

–°–æ–∑–¥–∞–¥–∏–º –≤—Å–µ REST API endpoints:

1. **api/auth.py** - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
   - POST /api/auth/login
   - POST /api/auth/refresh
   - POST /api/auth/logout

2. **api/majors.py** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
   - GET /api/majors

3. **api/subjects.py** - –ø—Ä–µ–¥–º–µ—Ç—ã
   - GET /api/subjects

4. **api/practice.py** - —Å–≤–æ–±–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º
   - POST /api/practice/start
   - GET /api/practice/{subject}/questions
   - POST /api/practice/submit-answer
   - POST /api/practice/finish

5. **api/exam.py** - —ç–∫–∑–∞–º–µ–Ω—ã
   - POST /api/exam/start
   - GET /api/exam/{attempt_id}
   - POST /api/exam/{attempt_id}/answer
   - POST /api/exam/{attempt_id}/submit
   - POST /api/exam/{attempt_id}/proctoring

6. **api/stats.py** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - GET /api/stats/my

7. **api/admin.py** - –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
   - POST /api/admin/users
   - GET /api/admin/users
   - GET /api/admin/attempts

---

## üéâ –ü–†–û–ì–†–ï–°–° –ü–†–û–ï–ö–¢–ê

- ‚úÖ **–≠—Ç–∞–ø 1:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–º–æ–¥–µ–ª–∏, Docker, SSL)
- ‚úÖ **–≠—Ç–∞–ø 2:** Pydantic —Å—Ö–µ–º—ã (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
- ‚úÖ **–≠—Ç–∞–ø 3:** –°–µ—Ä–≤–∏—Å—ã (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞) ‚Üê **–ì–û–¢–û–í–û!**
- ‚è≥ **–≠—Ç–∞–ø 4:** API Endpoints
- ‚è≥ **–≠—Ç–∞–ø 5:** Celery + Scripts
- ‚è≥ **–≠—Ç–∞–ø 6:** main.py + –º–∏–≥—Ä–∞—Ü–∏–∏

**–ó–∞–≤–µ—Ä—à–µ–Ω–æ: 50% (3 –∏–∑ 6 —ç—Ç–∞–ø–æ–≤)**

---

## üí° –ì–û–¢–û–í –ü–†–û–î–û–õ–ñ–ê–¢–¨?

–°–∫–∞–∂–∏ **"–ø—Ä–æ–¥–æ–ª–∂–∞–π"** –∏ —è –Ω–∞—á–Ω—É **–≠—Ç–∞–ø 4: API Endpoints!** üöÄ

–°–æ–∑–¥–∞–¥–∏–º –≤—Å–µ REST API —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π Swagger!
